@*
========================================
BACKEND DATA REQUIREMENTS
========================================
This page allows admins to create new events or edit existing ones.

FORM DATA TO SAVE/RETRIEVE:
- Event ID (int) - If editing existing event (from route parameter)
- Title (string) - events.title
- Event Type/Category (string) - events.event_type (e.g., "Community Event", "Workshop")
- Event Tags (List<int>) - Many-to-many relationship with tags table
  * Junction table: event_tags (event_id, tag_id)
- Description (text) - events.description (rich text content)
- Address/Location (string) - events.address
- Event Date (DateTime/Date) - events.event_date (single date for the event)
- Start Time (TimeSpan/Time) - events.start_time (event start time)
- End Time (TimeSpan/Time) - events.end_time (event end time)
- Cover Image (file upload) - events.cover_image_url or file path

NOTE: Date and times are separate fields:
- Use ONE date picker for the event date
- Use TWO time pickers for start and end times
- Backend should combine date + start_time and date + end_time into DateTime if needed

DATABASE OPERATIONS:
CREATE EVENT:
1. INSERT INTO events (title, event_type, description, address, event_date, start_time, end_time, cover_image_url)
2. INSERT INTO event_tags (event_id, tag_id) for each selected tag

EDIT EVENT:
1. GET event WHERE id = @eventId
2. Populate form with existing data
3. UPDATE events SET ... WHERE id = @eventId
4. DELETE FROM event_tags WHERE event_id = @eventId (clear old tags)
5. INSERT INTO event_tags ... (add new tags)

IMAGE UPLOAD HANDLING:
- Accept file uploads via <input type="file">
- Recommended storage: wwwroot/uploads/events/{eventId}_{filename}
- Save file path in events.cover_image_url
- Validate: Max size 5MB, allowed types: jpg, jpeg, png
- Consider cloud storage for production (Azure Blob, AWS S3)

TAG MANAGEMENT:
- Provide list of available tags from tags table
- Save selected tag IDs to event_tags junction table
- Display existing tags when editing (load from event_tags WHERE event_id = @eventId)

FORM SUBMISSION:
- Create: POST /Admin/Events/Create
- Edit: POST /Admin/Events/Edit/{id}
========================================
*@

@model HealingInWriting.Models.Events.CreateEventViewModel

@{
    ViewData["Title"] = Model.Id == 0 ? "Create Event" : "Edit Event";
}

@section Styles {
    <link rel="stylesheet" href="~/css/views/manage-events.css" asp-append-version="true" />
}

<main class="event-details-page">
    <form asp-area="Admin" asp-controller="Events" asp-action="Details" method="post" enctype="multipart/form-data" class="event-details">
        <input type="hidden" asp-for="Id" />
        <div asp-validation-summary="ModelOnly" class="text-danger"></div>

        <!-- Event Cover Image -->
        <div class="event-details__image-upload">
            <div class="event-details__image-placeholder">
                <!-- TODO: Implement image upload functionality -->
            </div>
        </div>

        <!-- Event Category Badge -->
        <div class="event-details__form-group">
            <label class="event-details__label">Event Type</label>
            <select asp-for="EventType" class="event-details__input">
                <option value="">Select Event Type</option>
                @foreach (var eventType in Enum.GetValues(typeof(HealingInWriting.Domain.Events.EventType)))
                {
                    <option value="@eventType">@eventType</option>
                }
            </select>
            <span asp-validation-for="EventType" class="text-danger"></span>
        </div>

        <!-- Tags Section -->
        <div class="event-details__tags-container">
            <input type="text" class="event-details__tag-search" placeholder="Search Tags..." id="tagSearch"/>

            @if (Model.AvailableTags?.Any() == true)
            {
                @foreach (var tag in Model.AvailableTags)
                {
                    <label class="event-details__tag">
                        <input type="checkbox" 
                               asp-for="SelectedTagIds" 
                               value="@tag.TagId" 
                               style="display: none;"
                               @(Model.SelectedTagIds.Contains(tag.TagId) ? "checked" : "") />
                        <span class="event-details__tag-text">@tag.Name</span>
                        <button class="event-details__tag-remove" type="button" onclick="this.parentElement.querySelector('input').checked = false; this.parentElement.style.display = 'none';">
                            <svg xmlns="http://www.w3.org/2000/svg" width="10.5" height="14" viewBox="0 0 24 24" fill="none">
                                <path d="M18 6L6 18M6 6l12 12" stroke="#2F1648" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </button>
                    </label>
                }
            }
        </div>

        <!-- Event Title Input -->
        <div class="event-details__form-group">
            <h4 class="event-details__form-label">Event Title</h4>
            <input asp-for="Title" type="text" class="event-details__input" placeholder="Enter event title..."/>
            <span asp-validation-for="Title" class="text-danger"></span>
        </div>

        <!-- Capacity Input -->
        <div class="event-details__form-group">
            <label class="event-details__label">Event Capacity</label>
            <input asp-for="Capacity" type="number" class="event-details__input" placeholder="Enter capacity..." min="1"/>
            <span asp-validation-for="Capacity" class="text-danger"></span>
        </div>

        <!-- Address Inputs -->
        <div class="event-details__form-group event-details__form-group--full-width">
            <label class="event-details__label">Street Address</label>
            <input asp-for="StreetAddress" type="text" class="event-details__input" placeholder="Enter street address..."/>
            <span asp-validation-for="StreetAddress" class="text-danger"></span>
        </div>

        <div class="event-details__form-group">
            <label class="event-details__label">Suburb</label>
            <input asp-for="Suburb" type="text" class="event-details__input" placeholder="Enter suburb..."/>
            <span asp-validation-for="Suburb" class="text-danger"></span>
        </div>

        <div class="event-details__form-group">
            <label class="event-details__label">City</label>
            <input asp-for="City" type="text" class="event-details__input" placeholder="Enter city..."/>
            <span asp-validation-for="City" class="text-danger"></span>
        </div>

        <div class="event-details__form-group">
            <label class="event-details__label">Province</label>
            <input asp-for="Province" type="text" class="event-details__input" placeholder="Enter province..."/>
            <span asp-validation-for="Province" class="text-danger"></span>
        </div>

        <div class="event-details__form-group">
            <label class="event-details__label">Postal Code</label>
            <input asp-for="PostalCode" type="text" class="event-details__input" placeholder="0000" maxlength="4"/>
            <span asp-validation-for="PostalCode" class="text-danger"></span>
        </div>

        <!-- Event Date Input -->
        <div class="event-details__form-group">
            <label class="event-details__label">Event Date</label>
            <input asp-for="EventDate" type="date" class="event-details__input" placeholder="mm/dd/yyyy"/>
            <span asp-validation-for="EventDate" class="text-danger"></span>
        </div>

        <!-- Start & End Times -->
        <div class="event-details__form-group event-details__form-group--full-width">
            <label class="event-details__label">Start & End Times</label>
            <div class="event-details__times-container">
                <input asp-for="StartTime" type="time" class="event-details__input event-details__input--time" placeholder="Start Time"/>
                <span class="event-details__time-separator">to</span>
                <input asp-for="EndTime" type="time" class="event-details__input event-details__input--time" placeholder="End Time"/>
            </div>
            <span asp-validation-for="StartTime" class="text-danger"></span>
            <span asp-validation-for="EndTime" class="text-danger"></span>
        </div>

        <!-- Description Rich Text Editor -->
        <div class="event-details__description-section">
            <label class="event-details__description-label">Description</label>
            <div class="event-details__editor">
                <div class="event-details__editor-toolbar">
                    <button class="event-details__toolbar-btn" type="button" title="Bold">
                        <svg xmlns="http://www.w3.org/2000/svg" width="10.5" height="14" viewBox="0 0 24 24" fill="none">
                            <path d="M6 4h8a4 4 0 0 1 4 4 4 4 0 0 1-4 4H6zM6 12h9a4 4 0 0 1 4 4 4 4 0 0 1-4 4H6z" stroke="#4B5563" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </button>
                    <button class="event-details__toolbar-btn" type="button" title="Italic">
                        <svg xmlns="http://www.w3.org/2000/svg" width="10.5" height="14" viewBox="0 0 24 24" fill="none">
                            <path d="M19 4h-9M14 20H5M15 4L9 20" stroke="#4B5563" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </button>
                    <button class="event-details__toolbar-btn" type="button" title="List">
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none">
                            <path d="M8 6h13M8 12h13M8 18h13M3 6h.01M3 12h.01M3 18h.01" stroke="#4B5563" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </button>
                </div>
                <textarea asp-for="Description" class="event-details__editor-textarea" placeholder="Enter description here..."></textarea>
            </div>
            <span asp-validation-for="Description" class="text-danger"></span>
        </div>

        <!-- Submit Button -->
        <button class="event-details__submit-btn" type="submit">
            <span class="event-details__submit-text">@(Model.Id == 0 ? "Create Event" : "Update Event")</span>
        </button>
    </form>
</main>

@section Scripts {
    <partial name="_ValidationScriptsPartial"/>
}