@*
========================================
ADMIN EVENT REGISTRATIONS PAGE
========================================
This page displays all registrations for a specific event with admin management capabilities.

REQUIRED DATA:
- Event details (title, date, capacity, registered count)
- Registration list with attendee details (name, email, phone, registration date)
- User vs guest distinction
- Admin override indicators

ACTIONS:
- Add manual registration (guest) with admin override
- Remove any registration with admin override
========================================
*@

@model HealingInWriting.Models.Events.EventRegistrationsViewModel

@{
    ViewData["Title"] = "Event Registrations";
}

@section Styles {
    <link rel="stylesheet" href="~/css/views/event-registrations.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/shared/modal.css" asp-append-version="true" />
}

<main class="event-registrations-page">
    <!-- Success/Error Messages -->
    @if (TempData["SuccessMessage"] != null)
    {
        <div class="alert alert--success">
            @TempData["SuccessMessage"]
        </div>
    }
    @if (TempData["ErrorMessage"] != null)
    {
        <div class="alert alert--error">
            @TempData["ErrorMessage"]
        </div>
    }

    <!-- Header Section -->
    <header class="event-registrations__header">
        <div class="event-registrations__header-content">
            <div class="event-registrations__header-text">
                <h1 class="event-registrations__title">Event Registrations</h1>
                <p class="event-registrations__subtitle">@Model.EventTitle</p>
                <p class="event-registrations__meta">
                    @Model.EventStartDateTime.ToString("dd MMMM yyyy • HH:mm")
                </p>
            </div>
            <button type="button" class="event-registrations__add-btn" data-modal-open="addRegistrationModal">
                <svg class="event-registrations__add-icon" xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 24 24" fill="none">
                    <path d="M12 5v14M5 12h14" stroke="#FFFFFF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <span class="event-registrations__add-text">Add Registration</span>
            </button>
        </div>

        <!-- Capacity Summary -->
        <div class="event-registrations__capacity">
            <div class="event-registrations__capacity-item">
                <span class="event-registrations__capacity-label">Capacity:</span>
                <span class="event-registrations__capacity-value">@Model.Capacity</span>
            </div>
            <div class="event-registrations__capacity-item">
                <span class="event-registrations__capacity-label">Registered:</span>
                <span class="event-registrations__capacity-value">@Model.RegisteredCount</span>
            </div>
            <div class="event-registrations__capacity-item">
                <span class="event-registrations__capacity-label">Available:</span>
                <span class="event-registrations__capacity-value">@(Model.Capacity - Model.RegisteredCount)</span>
            </div>
        </div>
    </header>

    <!-- Back Navigation -->
    <div class="event-registrations__nav">
        <a class="event-registrations__back-link" asp-area="Admin" asp-controller="Events" asp-action="Manage">
            <svg class="event-registrations__back-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none">
                <path d="M19 12H5M5 12l7 7M5 12l7-7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            Back to Manage Events
        </a>
    </div>

    <!-- Registrations List -->
    <section class="event-registrations__list-container">
        <div class="event-registrations__list-header">
            <h2 class="event-registrations__list-title">Registrations (@Model.RegisteredCount)</h2>
        </div>

        <div class="event-registrations__list">
            @if (!Model.Registrations.Any())
            {
                <div class="registration-item registration-item--empty">
                    <div class="registration-item__content">
                        <p class="registration-item__empty-text">No registrations yet for this event.</p>
                    </div>
                </div>
            }
            else
            {
                foreach (var registration in Model.Registrations)
                {
                    <article class="registration-item">
                        <div class="registration-item__content">
                            <!-- Attendee Info -->
                            <div class="registration-item__info">
                                <div class="registration-item__name-row">
                                    <h3 class="registration-item__name">@registration.AttendeeName</h3>
                                    @if (registration.IsGuest)
                                    {
                                        <span class="registration-item__badge registration-item__badge--guest">Guest</span>
                                    }
                                    @if (registration.IsAdminOverride)
                                    {
                                        <span class="registration-item__badge registration-item__badge--override">Admin Added</span>
                                    }
                                </div>
                                <div class="registration-item__details">
                                    <div class="registration-item__detail">
                                        <svg class="registration-item__icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none">
                                            <path d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" stroke="#4B5563" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        </svg>
                                        <span class="registration-item__detail-text">@registration.AttendeeEmail</span>
                                    </div>
                                    @if (!string.IsNullOrWhiteSpace(registration.AttendeePhone))
                                    {
                                        <div class="registration-item__detail">
                                            <svg class="registration-item__icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none">
                                                <path d="M22 16.92v3a2 2 0 01-2.18 2 19.79 19.79 0 01-8.63-3.07 19.5 19.5 0 01-6-6 19.79 19.79 0 01-3.07-8.67A2 2 0 014.11 2h3a2 2 0 012 1.72 12.84 12.84 0 00.7 2.81 2 2 0 01-.45 2.11L8.09 9.91a16 16 0 006 6l1.27-1.27a2 2 0 012.11-.45 12.84 12.84 0 002.81.7A2 2 0 0122 16.92z" stroke="#4B5563" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                            </svg>
                                            <span class="registration-item__detail-text">@registration.AttendeePhone</span>
                                        </div>
                                    }
                                    <div class="registration-item__detail">
                                        <svg class="registration-item__icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none">
                                            <rect x="3" y="4" width="18" height="18" rx="2" stroke="#4B5563" stroke-width="2"/>
                                            <path d="M16 2v4M8 2v4M3 10h18" stroke="#4B5563" stroke-width="2" stroke-linecap="round"/>
                                        </svg>
                                        <span class="registration-item__detail-text">Registered: @registration.RegistrationDate.ToString("dd MMM yyyy • HH:mm")</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Actions -->
                            <div class="registration-item__actions">
                                <form asp-area="Admin" asp-controller="Events" asp-action="RemoveRegistration"
                                      asp-route-registrationId="@registration.RegistrationId"
                                      asp-route-eventId="@Model.EventId"
                                      method="post"
                                      class="registration-item__remove-form"
                                      data-confirm-message="Are you sure you want to remove this registration?">
                                    @Html.AntiForgeryToken()
                                    <button type="submit" class="registration-item__btn registration-item__btn--remove">Remove</button>
                                </form>
                            </div>
                        </div>
                    </article>
                }
            }
        </div>
    </section>

    <!-- Add Registration Modal -->
    <div class="modal" id="addRegistrationModal">
        <div class="modal__backdrop" data-modal-close="addRegistrationModal"></div>
        <div class="modal__content">
            <div class="modal__header">
                <h2 class="modal__title">Add Registration</h2>
                <button type="button" class="modal__close" data-modal-close="addRegistrationModal" aria-label="Close">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                        <path d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>
            </div>

            <form asp-area="Admin" asp-controller="Events" asp-action="AddRegistration" asp-route-eventId="@Model.EventId" method="post" class="modal__form">
                @Html.AntiForgeryToken()

                <div class="modal__body">
                    <p class="modal__description">Add a manual registration for this event. This will bypass capacity limits.</p>

                    <div class="modal__form-group">
                        <label for="guestName" class="modal__label">Full Name *</label>
                        <input type="text"
                               id="guestName"
                               name="guestName"
                               class="modal__input"
                               placeholder="Enter attendee name"
                               required
                               maxlength="100" />
                    </div>

                    <div class="modal__form-group">
                        <label for="guestEmail" class="modal__label">Email Address *</label>
                        <input type="email"
                               id="guestEmail"
                               name="guestEmail"
                               class="modal__input"
                               placeholder="attendee@example.com"
                               required
                               maxlength="256" />
                    </div>

                    <div class="modal__form-group">
                        <label for="guestPhone" class="modal__label">Phone Number</label>
                        <input type="tel"
                               id="guestPhone"
                               name="guestPhone"
                               class="modal__input"
                               placeholder="Optional"
                               maxlength="20" />
                    </div>
                </div>

                <div class="modal__footer">
                    <button type="button" class="modal__button modal__button--secondary" data-modal-close="addRegistrationModal">
                        Cancel
                    </button>
                    <button type="submit" class="modal__button modal__button--primary">
                        Add Registration
                    </button>
                </div>
            </form>
        </div>
    </div>
</main>

@section Scripts {
    <script src="~/js/modal.js" asp-append-version="true"></script>
    <script src="~/js/admin/event-registrations.js" asp-append-version="true"></script>
}
