@model HealingInWriting.Models.Books.BookDetailViewModel

@{
    ViewData["Title"] = "Edit Book";
}

<link rel="stylesheet" href="~/css/views/add-book.css" asp-append-version="true" />
<script src="~/js/shared/tag-manager.js" asp-append-version="true"></script>
<script src="~/js/edit-book.js" asp-append-version="true"></script>

<div class="add-book">
    <div class="add-book__container">
        @using (Html.BeginForm("EditBook", "Books", FormMethod.Post, new { enctype = "multipart/form-data", area = "Admin", @class = "add-book__form" }))
        {
            @Html.AntiForgeryToken()
            @Html.HiddenFor(m => m.BookId)

            <!-- Top Section: Cover Image + ISBNs -->
            <div class="add-book__top-section">
                <div class="add-book__left-column">
                    <!-- Cover Image Display -->
                    <div class="add-book__form-group">
                        <label class="add-book__label">Cover image</label>
                        <div class="add-book__cover-upload" style="position:relative;">
                            @if (!string.IsNullOrEmpty(Model.ThumbnailUrl))
                            {
                                <img id="coverPreview" src="@Model.ThumbnailUrl"
                                     alt="Book cover preview"
                                     class="add-book__cover-preview"
                                     style="width:100%; height:100%; object-fit:cover; border-radius:8px; position:absolute; top:0; left:0; z-index:3;" />
                            }
                            else
                            {
                                <img id="coverPreview" src="~/images/placeholder-book.svg"
                                     alt="Book cover placeholder"
                                     class="add-book__cover-preview"
                                     style="width:100%; height:100%; object-fit:cover; border-radius:8px; position:absolute; top:0; left:0; z-index:3;" />
                            }
                            <input type="file" id="coverImage" name="CoverImage" accept="image/*" class="add-book__file-input" />
                            <label for="coverImage" class="add-book__cover-placeholder" id="coverPlaceholder" style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);z-index:2;">
                                <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#9CA3AF" stroke-width="1">
                                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                    <circle cx="8.5" cy="8.5" r="1.5"></circle>
                                    <polyline points="21 15 16 10 5 21"></polyline>
                                </svg>
                            </label>
                        </div>
                    </div>
                </div>

                <div class="add-book__right-column">
                    <!-- ISBNs Read-only -->
                    <div class="add-book__isbn-row">
                        <div class="add-book__form-group add-book__form-group--flex">
                            <div style="display: flex; flex-direction: row; gap: 16px; align-items: flex-start;">
                                <!-- Primary ISBN -->
                                <div class="add-book__isbn-field" style="display: flex; flex-direction: column; gap: 8px;">
                                    <label for="IsbnPrimary" class="add-book__label">ISBN 1</label>
                                    <input type="text" id="IsbnPrimary" name="IsbnPrimary" class="add-book__input"
                                           value="@(Model.IndustryIdentifiers != null && Model.IndustryIdentifiers.Count > 0 ? Model.IndustryIdentifiers[0] : "")"
                                           readonly />
                                </div>
                                <!-- Secondary ISBN -->
                                <div class="add-book__isbn-field" style="display: flex; flex-direction: column; gap: 8px;">
                                    <label for="IsbnSecondary" class="add-book__label">ISBN 2</label>
                                    <input type="text" id="IsbnSecondary" name="IsbnSecondary" class="add-book__input"
                                           value="@(Model.IndustryIdentifiers != null && Model.IndustryIdentifiers.Count > 1 ? Model.IndustryIdentifiers[1] : "")"
                                           readonly />
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Title Field -->
                    <div class="add-book__form-group">
                        <label for="Title" class="add-book__label">Title <span style="color:red">*</span></label>
                        <input type="text" id="Title" name="Title" class="add-book__input" placeholder="Book Title" required maxlength="200" value="@Model.Title" />
                    </div>
                    <!-- Author and Language Row -->
                    <div class="add-book__row">
                        <!-- Author(s) Field -->
                        <div class="add-book__form-group">
                            <label for="Authors" class="add-book__label">Author(s) <span style="color:red">*</span></label>
                            <input type="text" id="Authors" name="Authors" class="add-book__input" placeholder="Comma separated" required value="@Model.Authors" />
                        </div>
                        <div class="add-book__form-group">
                            <label for="Language" class="add-book__label">Language <span style="color:red">*</span></label>
                            <input type="text" id="Language" name="Language" class="add-book__input" placeholder="e.g. en" required maxlength="10" value="@Model.Language" />
                        </div>
                    </div>

                    <!-- Publish Date and Page Count Row -->
                    <div class="add-book__row">
                        <!-- Publish Date Field -->
                        <div class="add-book__form-group">
                            <label for="PublishedDate" class="add-book__label">Publish Date <span style="color:red">*</span></label>
                            <input type="text" id="PublishedDate" name="PublishedDate" class="add-book__input" placeholder="yyyy, yyyy-MM, or yyyy-MM-dd" required pattern="^\d{4}(-\d{2}){0,2}$" title="Date must be in yyyy, yyyy-MM, or yyyy-MM-dd format." value="@Model.PublishedDate" />
                        </div>
                        <div class="add-book__form-group">
                            <label for="PageCount" class="add-book__label">Page Count <span style="color:red">*</span></label>
                            <input type="number" id="PageCount" name="PageCount" class="add-book__input" placeholder="e.g. 300" min="1" required value="@Model.PageCount" />
                        </div>
                    </div>

                    <!-- Publisher Field -->
                    <div class="add-book__form-group">
                        <label for="Publisher" class="add-book__label">Publisher <span style="color:red">*</span></label>
                        <input type="text" id="Publisher" name="Publisher" class="add-book__input" placeholder="Publisher" required maxlength="100" value="@Model.Publisher" />
                    </div>

                    <!-- Category Field (Tag Input) -->
                    <div class="add-book__form-group">
                        <label for="Categories" class="add-book__label">Categories</label>
                        <input type="text" id="CategoriesInput" class="add-book__input" placeholder="Add category and press Enter" />
                        <div id="CategoryTags" style="margin-top:8px; display:flex; flex-wrap:wrap; gap:8px;"></div>
                        <input type="hidden" id="Categories" name="Categories" value="@(Model.Categories != null ? string.Join(",", Model.Categories) : "")" />
                    </div>

                    <!-- Middle Section: Condition and Price -->
                    <div class="add-book__middle-section">
                        <div class="add-book__row">
                            <div class="add-book__form-group">
                                <label for="Condition" class="add-book__label">Condition</label>
                                <input type="text" id="Condition" name="Condition" class="add-book__input" placeholder="Subtext" value="@Model.Condition"/>
                            </div>
                            <div class="add-book__form-group">
                                <label for="Price" class="add-book__label">Price</label>
                                <input type="number" step="0.01" id="Price" name="Price" class="add-book__input" placeholder="Subtext" value="@Model.Price"/>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Rich Text Editor Section -->
            <div class="add-book__editor-section">
                <div class="add-book__editor">
                    <div class="add-book__editor-toolbar">
                        <!-- Toolbar buttons (not functional, just for style) -->
                        <button type="button" class="add-book__editor-btn" title="Bold">
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none">
                                <path d="M6 4h8a4 4 0 0 1 4 4 4 4 0 0 1-4 4H6z" stroke="#4B5563" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                                <path d="M6 12h9a4 4 0 0 1 4 4 4 4 0 0 1-4 4H6z" stroke="#4B5563" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                            </svg>
                        </button>
                        <button type="button" class="add-book__editor-btn" title="Italic">
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none">
                                <line x1="19" y1="4" x2="10" y2="4" stroke="#4B5563" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                                <line x1="14" y1="20" x2="5" y2="20" stroke="#4B5563" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                                <line x1="15" y1="4" x2="9" y2="20" stroke="#4B5563" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                            </svg>
                        </button>
                        <button type="button" class="add-book__editor-btn" title="List">
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none">
                                <line x1="8" y1="6" x2="21" y2="6" stroke="#4B5563" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                                <line x1="8" y1="12" x2="21" y2="12" stroke="#4B5563" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                                <line x1="8" y1="18" x2="21" y2="18" stroke="#4B5563" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                                <line x1="3" y1="6" x2="3.01" y2="6" stroke="#4B5563" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                                <line x1="3" y1="12" x2="3.01" y2="12" stroke="#4B5563" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                                <line x1="3" y1="18" x2="3.01" y2="18" stroke="#4B5563" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                            </svg>
                        </button>
                    </div>
                    <textarea id="Description" name="Description" class="add-book__editor-textarea" placeholder="Enter description here..." maxlength="2000">@Model.Description</textarea>
                </div>
            </div>

            <!-- Bottom Section: Submit Button -->
            <div class="add-book__bottom-section">
                <button type="submit" class="add-book__submit-btn">Save Changes</button>
                <a type="button" href="@Url.Action("Manage", "Books", new { area = "Admin" })" class="add-book__discard-btn">Discard</a>
            </div>

            <input type="hidden" id="ThumbnailUrl" name="ThumbnailUrl" value="@Model.ThumbnailUrl" />
            <input type="hidden" id="SmallThumbnailUrl" name="SmallThumbnailUrl" value="@Model.ThumbnailUrl" />
        }
    </div>
</div>
