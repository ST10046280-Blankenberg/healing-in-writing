@model HealingInWriting.Models.Dashboard.MyStoriesViewModel
@using HealingInWriting.Domain.Stories
@{
    ViewData["Title"] = "My Stories";

    var pendingStories = Model.Stories.Where(s => s.Status == StoryStatus.Submitted).ToList();
    var publishedStories = Model.Stories.Where(s => s.Status == StoryStatus.Published).ToList();
    var draftStories = Model.Stories.Where(s => s.Status == StoryStatus.Draft).ToList();
}

@section Styles {
    <link rel="stylesheet" href="~/css/shared/search-bar.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/views/volunteer-my-stories.css" asp-append-version="true" />
}

@section Scripts {
    <script src="~/js/views/dashboard-my-stories.js" asp-append-version="true"></script>
}

<div class="my-stories">
    <!-- Header Section -->
    <section class="my-stories__header fade-in-up">
        <h1 class="my-stories__title">My Stories</h1>
        <p class="my-stories__subtitle">Manage your drafts, published stories, and pending submissions.</p>
    </section>

    <!-- Search Bar -->
    @{
        ViewData["SearchFormAction"] = "MyStories";
    }
    <partial name="_SearchAndFilterBar" model="Model.Filter" />

    <!-- Navigation Tabs -->
    <nav class="my-stories__nav">
        <button class="my-stories__nav-button my-stories__nav-button--active" data-tab="pending">
            <span class="my-stories__nav-label">Pending</span>
            <span class="my-stories__nav-badge">@pendingStories.Count</span>
        </button>

        <button class="my-stories__nav-button" data-tab="published">
            <span class="my-stories__nav-label">Published</span>
            <span class="my-stories__nav-badge">@publishedStories.Count</span>
        </button>

        <button class="my-stories__nav-button" data-tab="drafts">
            <span class="my-stories__nav-label">Drafts</span>
            <span class="my-stories__nav-badge">@draftStories.Count</span>
        </button>
    </nav>

    <!-- Stories List -->
    <div class="my-stories__list">
        @if (!Model.Stories.Any())
        {
            <div class="empty-state">
                <p>You haven't submitted any stories yet.</p>
                <a asp-area="" asp-controller="Stories" asp-action="Submit" class="btn btn-primary">Share Your Story</a>
            </div>
        }
        else
        {
            @foreach (var story in pendingStories)
            {
                <article class="story-card scroll-animate hover-lift" data-status="pending">
                    <div class="story-card__content">
                        <div class="story-card__header">
                            <h2 class="story-card__title">@story.Title</h2>
                            <span class="story-card__status story-card__status--pending">@story.Status</span>
                        </div>

                        <p class="story-card__description">
                            @story.Summary
                        </p>

                        <div class="story-card__meta">
                            <svg class="story-card__icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                                fill="currentColor">
                                <path
                                    d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z" />
                            </svg>
                            <p class="story-card__meta-text">
                                @{
                                    var timeAgo = DateTime.UtcNow - story.CreatedAt;
                                    var timeAgoText = timeAgo.TotalDays >= 1
                                    ? $"{(int)timeAgo.TotalDays} day{((int)timeAgo.TotalDays == 1 ? "" : "s")} ago"
                                    : timeAgo.TotalHours >= 1
                                    ? $"{(int)timeAgo.TotalHours} hour{((int)timeAgo.TotalHours == 1 ? "" : "s")} ago"
                                    : "Less than an hour ago";
                                }
                                Created: @timeAgoText
                            </p>
                        </div>
                    </div>

                    <div class="story-card__actions">
                        <a href="@Url.Action("Details", "Stories", new { area = "", id = story.StoryId })"
                            class="story-card__button">
                            <svg class="story-card__button-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                                fill="currentColor">
                                <path
                                    d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z" />
                            </svg>
                            <span class="story-card__button-text">View</span>
                        </a>
                    </div>
                </article>
            }

            @foreach (var story in publishedStories)
            {
                <article class="story-card hidden scroll-animate hover-lift" data-status="published">
                    <div class="story-card__content">
                        <div class="story-card__header">
                            <h2 class="story-card__title">@story.Title</h2>
                            <span class="story-card__status story-card__status--published">@story.Status</span>
                        </div>

                        <p class="story-card__description">
                            @story.Summary
                        </p>

                        <div class="story-card__meta">
                            <svg class="story-card__icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                                fill="currentColor">
                                <path
                                    d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z" />
                            </svg>
                            <p class="story-card__meta-text">
                                @{
                                    var timeAgo2 = DateTime.UtcNow - story.CreatedAt;
                                    var timeAgoText2 = timeAgo2.TotalDays >= 1
                                    ? $"{(int)timeAgo2.TotalDays} day{((int)timeAgo2.TotalDays == 1 ? "" : "s")} ago"
                                    : timeAgo2.TotalHours >= 1
                                    ? $"{(int)timeAgo2.TotalHours} hour{((int)timeAgo2.TotalHours == 1 ? "" : "s")} ago"
                                    : "Less than an hour ago";
                                }
                                Published: @timeAgoText2
                            </p>
                        </div>
                    </div>

                    <div class="story-card__actions">
                        <a href="@Url.Action("Details", "Stories", new { area = "", id = story.StoryId })"
                            class="story-card__button">
                            <svg class="story-card__button-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                                fill="currentColor">
                                <path
                                    d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z" />
                            </svg>
                            <span class="story-card__button-text">View</span>
                        </a>
                    </div>
                </article>
            }

            @foreach (var story in draftStories)
            {
                <article class="story-card hidden scroll-animate hover-lift" data-status="drafts">
                    <div class="story-card__content">
                        <div class="story-card__header">
                            <h2 class="story-card__title">@story.Title</h2>
                            <span class="story-card__status story-card__status--draft">@story.Status</span>
                        </div>

                        <p class="story-card__description">
                            @story.Summary
                        </p>

                        <div class="story-card__meta">
                            <svg class="story-card__icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                                fill="currentColor">
                                <path
                                    d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z" />
                            </svg>
                            <p class="story-card__meta-text">
                                @{
                                    var timeAgo3 = DateTime.UtcNow - story.CreatedAt;
                                    var timeAgoText3 = timeAgo3.TotalDays >= 1
                                    ? $"{(int)timeAgo3.TotalDays} day{((int)timeAgo3.TotalDays == 1 ? "" : "s")} ago"
                                    : timeAgo3.TotalHours >= 1
                                    ? $"{(int)timeAgo3.TotalHours} hour{((int)timeAgo3.TotalHours == 1 ? "" : "s")} ago"
                                    : "Less than an hour ago";
                                }
                                Last updated: @timeAgoText3
                            </p>
                        </div>
                    </div>

                    <div class="story-card__actions">
                        <a href="@Url.Action("Details", "Stories", new { area = "", id = story.StoryId })"
                            class="story-card__button">
                            <svg class="story-card__button-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                                fill="currentColor">
                                <path
                                    d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z" />
                            </svg>
                            <span class="story-card__button-text">View</span>
                        </a>
                    </div>
                </article>
            }
        }
    </div>
</div>