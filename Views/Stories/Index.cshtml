@model HealingInWriting.Models.Stories.StoryListWithFilterViewModel

@{
    ViewData["Title"] = "Community Stories";
}

@section Styles {
    <link rel="stylesheet" href="~/css/shared/page-hero.css" />
    <link rel="stylesheet" href="~/css/shared/search-bar.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/views/stories.css" asp-append-version="true" />
}

<main class="stories">
    <!-- Hero Section -->
    <section class="page-hero page-hero--stories">
        <div class="page-hero__content">
            <h1 class="page-hero__title">Community Stories</h1>
            <p class="page-hero__subtitle">Discover inspiring stories from our community members. Share experiences, learn from others, and connect through the power of storytelling.</p>
        </div>
        @* </section> *@

        <!-- Combined Navigation and Search Section -->
        <section class="stories__search-section">
            <partial name="_StoriesSearchBar" model="Model.Filter" />
        </section>
    </section>

    <!-- Stories Masonry Grid -->
    <section class="stories__content">
        <div class="stories__masonry">
            @if (Model?.StoryList?.Stories?.Any() == true)
            {
                var stories = Model.StoryList.Stories;
                int storyIndex = 0;

                while (storyIndex < stories.Count)
                {
                    var cyclePosition = (storyIndex / 3) % 4; // 4-row cycle: 0, 1, 2, 3

                    if (cyclePosition == 0)
                    {
                        // Row 1: Large Left + 2 Small Right (Stacked)
                        <div class="stories__row">
                            <div class="stories__column stories__column--large">
                                <partial name="_StoryCardLarge" model="@stories[storyIndex]" />
                            </div>
                            <div class="stories__column stories__column--small-stack">
                                @if (storyIndex + 1 < stories.Count)
                                {
                                    <partial name="_StoryCardSmall" model="@stories[storyIndex + 1]" />
                                }
                                @if (storyIndex + 2 < stories.Count)
                                {
                                    <partial name="_StoryCardSmall" model="@stories[storyIndex + 2]" />
                                }
                            </div>
                        </div>
                        storyIndex += 3;
                    }
                    else if (cyclePosition == 1)
                    {
                        // Row 2: Small Left + Small Right (Side-by-Side)
                        <div class="stories__row stories__row--two-small">
                            <div class="stories__column stories__column--small-single">
                                <partial name="_StoryCardSmall" model="@stories[storyIndex]" />
                            </div>
                            @if (storyIndex + 1 < stories.Count)
                            {
                                <div class="stories__column stories__column--small-single">
                                    <partial name="_StoryCardSmall" model="@stories[storyIndex + 1]" />
                                </div>
                            }
                        </div>
                        storyIndex += 2;
                    }
                    else if (cyclePosition == 2)
                    {
                        // Row 3: 2 Small Left (Stacked) + Large Right
                        <div class="stories__row stories__row--reversed">
                            <div class="stories__column stories__column--small-stack">
                                <partial name="_StoryCardSmall" model="@stories[storyIndex]" />
                                @if (storyIndex + 1 < stories.Count)
                                {
                                    <partial name="_StoryCardSmall" model="@stories[storyIndex + 1]" />
                                }
                            </div>
                            @if (storyIndex + 2 < stories.Count)
                            {
                                <div class="stories__column stories__column--large">
                                    <partial name="_StoryCardLarge" model="@stories[storyIndex + 2]" />
                                </div>
                            }
                        </div>
                        storyIndex += 3;
                    }
                    else
                    {
                        // Row 4: Small Left + Small Right (Side-by-Side)
                        <div class="stories__row stories__row--two-small">
                            <div class="stories__column stories__column--small-single">
                                <partial name="_StoryCardSmall" model="@stories[storyIndex]" />
                            </div>
                            @if (storyIndex + 1 < stories.Count)
                            {
                                <div class="stories__column stories__column--small-single">
                                    <partial name="_StoryCardSmall" model="@stories[storyIndex + 1]" />
                                </div>
                            }
                        </div>
                        storyIndex += 2;
                    }
                }
            }
            else
            {
                <div class="stories__empty">
                    <div class="stories__empty-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none">
                            <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z" stroke="currentColor" stroke-width="2" fill="none" />
                            <path d="M9 11h6M9 15h3" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                        </svg>
                    </div>
                    <h2 class="stories__empty-title">No Stories Yet</h2>
                    <p class="stories__empty-text">Be the first to share your story with the community. Your experience could inspire and help others on their healing journey.</p>
                    <a asp-area="" asp-controller="Stories" asp-action="Submit" class="stories__empty-button">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none">
                            <path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                        </svg>
                        Write Your Story
                    </a>
                </div>
            }
        </div>
    </section>
</main>

@section Scripts {
    <script>
        // TODO: Implement story filtering and search functionality
        // TODO: Implement dynamic masonry layout
    </script>
}
