@model HealingInWriting.Models.Stories.StoryDetailViewModel

@{
    ViewData["Title"] = "Story Details";
    var displayDate = Model.CreatedAt.ToLocalTime().ToString("MMMM d, yyyy");
    var isAuthenticated = User.Identity?.IsAuthenticated ?? false;
    var isAdmin = User.IsInRole("Admin");
    var defaultBackLink = isAdmin
        ? Url.Action("Manage", "Stories", new { area = "Admin" })
        : isAuthenticated
            ? Url.Action("MyStories", "Dashboard", new { area = "" })
            : Url.Action("Index", "Stories", new { area = "" });
    var backLink = !string.IsNullOrWhiteSpace(Model.ReturnUrl) ? Model.ReturnUrl : defaultBackLink;
}

@section Styles {
    <link rel="stylesheet" href="~/css/views/stories.css" asp-append-version="true" />
}

<main class="story-details">
    <div class="story-details__body">
        <article class="story-details__container">
            <div class="story-details__content">
                <div class="story-details__nav">
                    <a href="@backLink" class="story-details__back-btn">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                            <path d="M19 12H5M12 19l-7-7 7-7" stroke="#1D1B20" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </a>
                    @if (isAdmin)
                    {
                        <div class="story-details__actions">
                            <form asp-area="Admin" asp-controller="Stories" asp-action="Approve" method="post" class="story-details__action-form">
                                @Html.AntiForgeryToken()
                                <input type="hidden" name="id" value="@Model.StoryId" />
                                <input type="hidden" name="returnUrl" value="@backLink" />
                                <button class="story-details__btn story-details__btn--primary" type="submit">
                                    <span class="story-details__btn-text">Approve</span>
                                </button>
                            </form>
                            <form asp-area="Admin" asp-controller="Stories" asp-action="Reject" method="post" class="story-details__action-form">
                                @Html.AntiForgeryToken()
                                <input type="hidden" name="id" value="@Model.StoryId" />
                                <input type="hidden" name="returnUrl" value="@backLink" />
                                <button class="story-details__btn story-details__btn--secondary" type="submit">
                                    <span class="story-details__btn-text">Reject</span>
                                </button>
                            </form>
                        </div>
                    }
                </div>

                <!-- Hero Image -->
                <div class="story-details__image">
                    <!-- Image with gradient overlay -->
                </div>

                <!-- Article Content -->
                <div class="story-details__article">
                    <!-- Header Section -->
                    <header class="story-details__header">
                        <h1 class="story-details__title">@Model.Title</h1>
                        <p class="story-details__meta">By @Model.AuthorName, @displayDate</p>
                    </header>

                    <!-- Tags Section -->
                    @if (Model.Tags?.Any() == true)
                    {
                        <div class="story-details__tags">
                            @foreach (var tag in Model.Tags)
                            {
                                <span class="story-details__tag">
                                    <span class="story-details__tag-text">@tag.Name</span>
                                </span>
                            }
                        </div>
                    }

                    <!-- Article Text Content -->
                    <div class="story-details__text-container">
                        <div class="story-details__text-wrapper">
                            <div class="story-details__text">
                                @Html.Raw(Model.Content)
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </article>
    </div>
</main>
