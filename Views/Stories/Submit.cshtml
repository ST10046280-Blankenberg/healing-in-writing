@using System.Security.Claims
@{
    ViewData["Title"] = "Submit a Story";
    var userId = User.FindFirstValue(ClaimTypes.NameIdentifier) ?? "anonymous";
}

@section Styles {
    <link rel="stylesheet" href="~/css/views/stories.css" asp-append-version="true" />
    <!-- Quill Editor CSS -->
    <link href="https://cdn.jsdelivr.net/npm/quill@2.0.3/dist/quill.snow.css" rel="stylesheet">
}

<main class="story-submit" data-user-id="@userId">
    <div class="story-submit__body">
        <!-- Header Section -->
        <section class="story-submit__header">
            <h1 class="story-submit__title">Submit a Story</h1>
            <p class="story-submit__subtitle">Share your experience with the community. Your story could inspire or help others.</p>
        </section>

        <!-- Main Container -->
        <div class="story-submit__container">
            <!-- Form Container -->
            <div class="story-submit__form-container">
                <form method="post" asp-area="" asp-controller="Stories" asp-action="Submit" enctype="multipart/form-data">
                    @Html.AntiForgeryToken()

                    <!-- Display validation errors -->
                    <div asp-validation-summary="All" class="text-danger"></div>

                    <!-- Story Title Field -->
                    <div class="story-submit__field">
                        <label class="story-submit__field-label" for="title">Story Title</label>
                        <input class="story-submit__input" type="text" id="title" name="title" placeholder="Enter your story title..." />
                    </div>

                    <!-- Cover Image Upload -->
                    <div class="story-submit__field">
                        <label class="story-submit__field-label">Cover Image (Optional)</label>
                        <div class="story-submit__image-upload">
                            <div class="story-submit__image-placeholder" id="imageUploadArea">
                                <div class="story-submit__upload-content">
                                    <svg class="story-submit__upload-icon" xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                        <circle cx="8.5" cy="8.5" r="1.5"></circle>
                                        <polyline points="21 15 16 10 5 21"></polyline>
                                    </svg>
                                    <span class="story-submit__upload-text">Click to upload cover image</span>
                                    <span class="story-submit__upload-hint">JPG, PNG, GIF, WEBP (Max 5MB)</span>
                                </div>
                                <label for="coverImage" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; cursor: pointer; z-index: 5;"></label>
                            </div>
                            <input type="file" id="coverImage" name="coverImage" accept="image/*" style="display: none;" />
                            <img id="imagePreview" style="display: none; max-width: 100%; margin-top: 10px; border-radius: 8px;" alt="Image preview" />
                        </div>
                    </div>

                    <!-- Story Content Field -->
                    <div class="story-submit__field">
                        <label class="story-submit__field-label" for="content">Your Story</label>
                        <!-- Rich Text Editor Container -->
                        <div id="quill-editor" class="story-submit__textarea"></div>
                        <!-- Hidden field for form submission -->
                        <input type="hidden" id="content" name="content" />
                        <!-- Word Counter -->
                        <div class="story-submit__word-counter">
                            <span class="story-submit__word-count">0 words</span>
                            <span class="story-submit__char-count">0 characters</span>
                        </div>
                    </div>

                    <!-- Tags Field -->
                    <div class="story-submit__field">
                        <label class="story-submit__tags-label" for="tagsInput">
                            <svg class="story-submit__tags-icon" viewBox="0 0 24 24" fill="none">
                                <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z" stroke="currentColor" stroke-width="2" fill="none"/>
                                <line x1="7" y1="7" x2="7.01" y2="7" stroke="currentColor" stroke-width="2"/>
                            </svg>
                            Tags
                        </label>

                        <!-- Selected Tags Display (populated by JavaScript) -->
                        <div id="storyTags" class="story-submit__selected-tags"></div>

                        <!-- Tag Input -->
                        <input class="story-submit__input" type="text" id="tagsInput" placeholder="Add tags (press Enter)" />
                        <input type="hidden" id="tags" name="tags" />
                    </div>

                    <!-- Anonymous Checkbox -->
                    <div class="story-submit__checkbox-group">
                        <input class="story-submit__checkbox" type="checkbox" id="anonymous" name="anonymous" value="true" />
                        <label class="story-submit__checkbox-label" for="anonymous">
                            <svg class="story-submit__checkbox-icon" viewBox="0 0 24 24" fill="none">
                                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" stroke="currentColor" stroke-width="2" fill="none"/>
                                <circle cx="12" cy="7" r="4" stroke="currentColor" stroke-width="2" fill="none"/>
                            </svg>
                            Hide my identity (post anonymously)
                        </label>
                    </div>

                    <!-- Consent Checkbox -->
                    <div class="story-submit__checkbox-group">
                        <input class="story-submit__checkbox" type="checkbox" id="consent" name="consent" value="true" required />
                        <label class="story-submit__checkbox-label" for="consent">
                            <svg class="story-submit__checkbox-icon" viewBox="0 0 24 24" fill="none">
                                <path d="M9 11l3 3l8-8" stroke="currentColor" stroke-width="2" fill="none"/>
                                <path d="M21 12c0 4.97-4.03 9-9 9s-9-4.03-9-9 4.03-9 9-9c1.51 0 2.93.37 4.18 1.03" stroke="currentColor" stroke-width="2" fill="none"/>
                            </svg>
                            I understand and consent to sharing my story for review
                        </label>
                    </div>

                    <!-- Buttons -->
                    <div class="story-submit__buttons">
                        <button type="button" class="btn btn--secondary">
                            Save Draft
                        </button>
                        <button type="submit" class="btn btn--primary">
                            Submit for Review
                        </button>
                    </div>
                </form>
            </div>

            <!-- Sidebar -->
            <div class="story-submit__sidebar">
                <!-- Guidelines Card -->
                <div class="story-submit__guidelines">
                    <h3 class="story-submit__guidelines-header">
                        <svg class="story-submit__guidelines-icon" viewBox="0 0 24 24" fill="none">
                            <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z" fill="currentColor"/>
                        </svg>
                        <span class="story-submit__guidelines-title">Guidelines</span>
                    </h3>
                    <ul class="story-submit__guidelines-list">
                        <li class="story-submit__guideline-item">
                            <svg class="story-submit__guideline-icon" viewBox="0 0 24 24" fill="none">
                                <polyline points="20,6 9,17 4,12" stroke="currentColor" stroke-width="2" fill="none"/>
                            </svg>
                            <span class="story-submit__guideline-text">Be respectful and kind to others</span>
                        </li>
                        <li class="story-submit__guideline-item">
                            <svg class="story-submit__guideline-icon" viewBox="0 0 24 24" fill="none">
                                <polyline points="20,6 9,17 4,12" stroke="currentColor" stroke-width="2" fill="none"/>
                            </svg>
                            <span class="story-submit__guideline-text">Avoid sharing personal information</span>
                        </li>
                        <li class="story-submit__guideline-item">
                            <svg class="story-submit__guideline-icon" viewBox="0 0 24 24" fill="none">
                                <polyline points="20,6 9,17 4,12" stroke="currentColor" stroke-width="2" fill="none"/>
                            </svg>
                            <span class="story-submit__guideline-text">Focus on your experience and growth</span>
                        </li>
                        <li class="story-submit__guideline-item">
                            <svg class="story-submit__guideline-icon" viewBox="0 0 24 24" fill="none">
                                <polyline points="20,6 9,17 4,12" stroke="currentColor" stroke-width="2" fill="none"/>
                            </svg>
                            <span class="story-submit__guideline-text">Use appropriate language</span>
                        </li>
                        <li class="story-submit__guideline-item">
                            <svg class="story-submit__guideline-icon" viewBox="0 0 24 24" fill="none">
                                <polyline points="20,6 9,17 4,12" stroke="currentColor" stroke-width="2" fill="none"/>
                            </svg>
                            <span class="story-submit__guideline-text">Stories will be reviewed before publishing</span>
                        </li>
                    </ul>
                </div>

                <!-- Help Card -->
                <div class="story-submit__help">
                    <h4 class="story-submit__help-title">Need Help?</h4>
                    <p class="story-submit__help-text">Our community team is here to support you through the submission process.</p>
                    <button type="button" class="btn btn--secondary btn--small">
                        <svg class="story-submit__help-icon" viewBox="0 0 24 24" fill="none" style="width: 16px; height: 16px; margin-right: 8px;">
                            <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z" stroke="currentColor" stroke-width="2" fill="none"/>
                            <polyline points="22,6 12,13 2,6" stroke="currentColor" stroke-width="2" fill="none"/>
                        </svg>
                        Contact Support
                    </button>
                </div>
            </div>
        </div>
    </div>
</main>

@section Scripts {
    <!-- Quill Editor JS -->
    <script src="https://cdn.jsdelivr.net/npm/quill@2.0.3/dist/quill.js"></script>
    <!-- Tag Manager -->
    <script src="~/js/shared/tag-manager.js" asp-append-version="true"></script>
    <script src="~/js/story-submit.js" asp-append-version="true"></script>
}

